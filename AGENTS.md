# Repository Guidelines

## Project Structure & Module Organization

- `src/`: Library source (core in `shield.ts`, rules in `rule.ts`, operators in
  `operators.ts`, public exports in `index.ts`).
- `test/`: Vitest suites (`*.test.ts`) plus helpers.
- `dist/`: Compiled output (generated by `tsc`; do not edit).
- `example/`: Example app; excluded from builds and coverage.
- Config: `eslint.config.js`, `prettier.config.js`, `tsconfig*.json`,
  `vitest.config.ts`.

## Build, Test, and Development Commands

- `pnpm i`: Install dependencies.
- `pnpm build`: TypeScript build to `dist/`.
- `pnpm typecheck`: Strict TS checks.
- `pnpm lint` / `pnpm lint:fix`: Lint (ESLint) and optionally fix.
- `pnpm test`: Run Vitest; `VITEST_POOL=threads pnpm test` in sandboxed envs.
- `pnpm prettier`: Format per Prettier config.
- `pnpm commit`: Commitizen prompt for conventional commits.

## Coding Style & Naming Conventions

- TypeScript, ESM. Target Node 18+, `ES2020`.
- Formatting: Prettier (2-space, semicolons, single quotes, width 100 TS / 80
  MD/YAML).
- Linting: ESLint with `@typescript-eslint` + Prettier. Prefer `const`, arrows,
  object shorthand, sorted imports.
- Naming: `camelCase` vars/functions, `PascalCase` types/classes, files
  `kebab-case.ts`.
- Do not commit generated files (`dist/`, coverage, vendor locks in example
  unless relevant).

## Testing Guidelines

- Framework: Vitest (node env). Tests: `test/**/*.{test,spec}.ts`.
- Coverage: Global thresholds 90% lines/branches/functions/statements.
- Conventions: Mirror `src/` APIs; name tests after subject (e.g.,
  `shield.test.ts`).
- Run locally: `pnpm test:coverage` before PRs.

## Commit & Pull Request Guidelines

- Conventional Commits enforced by Commitlint + Husky. Use `pnpm commit`.
- Allowed scopes: `core`, `rule`, `operators`, `middleware`, `types`, `test`,
  `example`, `docs`, `config`, `deps`, `release`.
- Example: `feat(middleware): add denyErrorCode mapping`.
- PRs: clear description, link issues (`#123`), add/adjust tests, update docs if
  behavior changes, include output/screenshots for example changes.

## Security & Configuration

- Node 18+ recommended. Do not log secrets; avoid side effects in rules.
- Pre-commit runs lint, typecheck, and tests via Husky; ensure a clean run
  before pushing.
- Publishing (`pnpm release`) is maintainer-only; contributors should not run
  release scripts.
